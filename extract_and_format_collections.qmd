---
title: "Extract and format HAL collections"
format: html
editor: visual
---

```{r setup}
library(HALtere)
collections=c("BIOEENVIS","EVS_UMR5600","OSR","PEPR_ONEWATER","LEHNA")
#collections="EVS_UMR5600"
```

# Extract data

```{r}
for(collection in collections){
  datadir=glue::glue("data/{collection}")
  dir.create(datadir,showWarnings = FALSE)
  publications=extract_collection(collection)
  saveRDS(publications,glue::glue("{datadir}/publications.RDS"))
}
```

# Extract data_authors

```{r}
for(collection in collections){
  datadir=glue::glue("data/{collection}")
  publications=readRDS(glue::glue("{datadir}/publications.RDS"))
  data_ref_authors=tidy_ref_authors(publications)
  data_authors=tidy_authors(publications)
  
  saveRDS(data_ref_authors,glue::glue("{datadir}/data_ref_authors.RDS"))
  saveRDS(data_authors,glue::glue("{datadir}/data_authors.RDS"))
}
```

# Extract crossed data

```{r}
for(collection in collections){
  datadir=glue::glue("data/{collection}")
  data_ref_authors=readRDS(glue::glue("{datadir}/data_ref_authors.RDS"))
  data_authors=readRDS(glue::glue("{datadir}/data_authors.RDS"))
  crossed_auth=HALtere::cross(data_by_ref=data_ref_authors,
                              data_by_structure=data_authors,
                              var_to_cross="name") 
  saveRDS(crossed_auth,glue::glue("{datadir}/crossed_authors.RDS"))
  crossed_aff=HALtere::cross(data_by_ref=data_ref_authors,
                             data_by_structure=data_authors,
                             var_to_cross="affiliation")
  saveRDS(crossed_aff,glue::glue("{datadir}/crossed_affiliations.RDS"))
}
```

# Extract text_title

```{r}
for(collection in collections){
  datadir=glue::glue("data/{collection}")
  publications=readRDS(glue::glue("{datadir}/publications.RDS"))
  text_title=tidy_text(publications,"text")
  saveRDS(text_title,
          glue::glue("{datadir}/text.RDS"))
}
```
